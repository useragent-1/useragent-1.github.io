<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ§åˆ¶é¢æ¿ - æ–‡æ¡£ç®¡ç†ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="/css/style.css">
    <style>
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .stat-card {
            background-color: #fff;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #007bff;
            margin: 10px 0;
        }
        .stat-label {
            color: #666;
            font-size: 1rem;
        }
        .shortcuts {
            margin-top: 40px;
        }
        .shortcut-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .shortcut-card {
            display: flex;
            align-items: center;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            transition: all 0.3s ease;
            text-decoration: none;
            color: #333;
        }
        .shortcut-card:hover {
            background-color: #e9ecef;
            transform: translateY(-3px);
        }
        .shortcut-icon {
            font-size: 24px;
            width: 40px;
            text-align: center;
            margin-right: 15px;
        }
        .shortcut-text {
            font-weight: bold;
        }
        
        /* æ–°çš„æ¬¢è¿æ¶ˆæ¯æ ·å¼ */
        .welcome-message {
            background: linear-gradient(135deg, rgba(13, 71, 161, 0.7), rgba(33, 150, 243, 0.5));
            border-left: 4px solid #00c7be;
            padding: 25px;
            margin-bottom: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            animation: pulse-glow 3s infinite;
            position: relative;
            overflow: hidden;
        }
        
        .welcome-message::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                to bottom right,
                rgba(10, 132, 255, 0.1),
                rgba(94, 92, 230, 0.1),
                rgba(0, 199, 190, 0.1)
            );
            transform: rotate(30deg);
            z-index: -1;
            pointer-events: none;
            animation: rotate 15s linear infinite;
        }
        
        .welcome-message h2 {
            font-size: 2rem;
            margin-bottom: 10px;
            background: linear-gradient(to right, #ffffff, #4ef2f8);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 10px rgba(78, 242, 248, 0.5);
            animation: text-flicker 5s infinite;
        }
        
        .welcome-message p {
            color: #ffffff;
            font-size: 1.1rem;
            line-height: 1.6;
            letter-spacing: 0.5px;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.2);
        }
        
        .welcome-message span {
            color: #4ef2f8;
            font-weight: bold;
            position: relative;
            display: inline-block;
            text-shadow: 0 0 10px rgba(78, 242, 248, 0.8);
            animation: name-highlight 4s infinite;
        }
        
        /* å¼¹å¹•åŒºåŸŸæ ·å¼ */
        .danmaku-container {
            height: 200px;
            background: rgba(0, 20, 40, 0.3);
            border-radius: 10px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(10, 132, 255, 0.3);
            box-shadow: 0 0 20px rgba(0, 199, 190, 0.2) inset;
        }
        
        .danmaku-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: linear-gradient(90deg, rgba(10, 132, 255, 0.3), rgba(0, 199, 190, 0.3));
            border-radius: 10px 10px 0 0;
        }
        
        .danmaku-title {
            color: #fff;
            font-size: 1.2rem;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(78, 242, 248, 0.5);
            display: flex;
            align-items: center;
        }
        
        .danmaku-title i {
            margin-right: 8px;
            color: #4ef2f8;
        }
        
        .danmaku-controls {
            display: flex;
            align-items: center;
        }
        
        .danmaku-controls button {
            background: rgba(10, 132, 255, 0.3);
            border: 1px solid rgba(78, 242, 248, 0.5);
            color: #fff;
            border-radius: 4px;
            padding: 5px 10px;
            margin-left: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .danmaku-controls button:hover {
            background: rgba(10, 132, 255, 0.5);
            box-shadow: 0 0 10px rgba(78, 242, 248, 0.5);
        }
        
        .danmaku-content {
            height: calc(100% - 50px);
            position: relative;
            overflow: hidden;
        }
        
        .danmaku-item {
            position: absolute;
            display: inline-block;
            padding: 5px 12px;
            background: rgba(10, 132, 255, 0.2);
            border-radius: 20px;
            color: #fff;
            font-size: 14px;
            white-space: nowrap;
            border: 1px solid rgba(78, 242, 248, 0.3);
            box-shadow: 0 0 10px rgba(78, 242, 248, 0.3);
            animation-name: danmaku-move;
            animation-timing-function: linear;
            animation-fill-mode: forwards;
        }
        
        .danmaku-item.type-1 {
            background: rgba(10, 132, 255, 0.2);
            border-color: rgba(10, 132, 255, 0.5);
        }
        
        .danmaku-item.type-2 {
            background: rgba(0, 199, 190, 0.2);
            border-color: rgba(0, 199, 190, 0.5);
        }
        
        .danmaku-item.type-3 {
            background: rgba(94, 92, 230, 0.2);
            border-color: rgba(94, 92, 230, 0.5);
        }
        
        .danmaku-input-container {
            display: flex;
            padding: 10px 15px;
            background: rgba(0, 20, 40, 0.3);
            border-radius: 0 0 10px 10px;
            border-top: 1px solid rgba(10, 132, 255, 0.3);
        }
        
        .danmaku-input {
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(78, 242, 248, 0.3);
            border-radius: 20px;
            padding: 8px 15px;
            color: #fff;
            outline: none;
        }
        
        .danmaku-input:focus {
            border-color: rgba(78, 242, 248, 0.8);
            box-shadow: 0 0 10px rgba(78, 242, 248, 0.3);
        }
        
        .danmaku-send {
            background: linear-gradient(90deg, #0a84ff, #00c7be);
            color: white;
            border: none;
            border-radius: 20px;
            padding: 8px 20px;
            margin-left: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .danmaku-send:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(10, 132, 255, 0.5);
        }
        
        @keyframes danmaku-move {
            from { transform: translateX(100%); }
            to { transform: translateX(-100%); }
        }
        
        @keyframes pulse-glow {
            0% { box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); }
            50% { box-shadow: 0 5px 25px rgba(0, 199, 190, 0.5); }
            100% { box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); }
        }
        
        @keyframes rotate {
            0% { transform: rotate(30deg); }
            100% { transform: rotate(390deg); }
        }
        
        @keyframes text-flicker {
            0% { opacity: 1; }
            3% { opacity: 0.8; }
            6% { opacity: 1; }
            7% { opacity: 0.9; }
            8% { opacity: 1; }
            9% { opacity: 0.9; }
            10% { opacity: 1; }
            100% { opacity: 1; }
        }
        
        @keyframes name-highlight {
            0% { transform: scale(1); text-shadow: 0 0 10px rgba(78, 242, 248, 0.8); }
            50% { transform: scale(1.05); text-shadow: 0 0 20px rgba(78, 242, 248, 1); }
            100% { transform: scale(1); text-shadow: 0 0 10px rgba(78, 242, 248, 0.8); }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>æ§åˆ¶é¢æ¿</h2>
            </div>
            <ul class="sidebar-menu">
                <li class="active"><a href="/dashboard">ä¸»é¡µ</a></li>
                <li><a href="/dashboard/profile">ä¸ªäººä¿¡æ¯</a></li>
                <li><a href="/dashboard/change-password">ä¿®æ”¹å¯†ç </a></li>
                <li><a href="/dashboard/documents">æ–‡æ¡£ç®¡ç†</a></li>
                <li><a href="/dashboard/categories">åˆ†ç±»ç®¡ç†</a></li>
                <li><a href="/danmaku">å¼¹å¹•å¢™</a></li>
                <li><a href="/" target="_blank">è®¿é—®é¦–é¡µ</a></li>
                <li><a href="/logout">é€€å‡ºç™»å½•</a></li>
            </ul>
        </div>
        
        <div class="main-content">
            <div class="dashboard-header">
                <div class="dashboard-title">
                    <h1>æ§åˆ¶é¢æ¿</h1>
                </div>
            </div>
            
            <!-- å¼¹å¹•å¢™ -->
            <div class="danmaku-container">
                <div class="danmaku-header">
                    <div class="danmaku-title">
                        <i class="fas fa-comments"></i>
                        ç³»ç»Ÿæ¶ˆæ¯å¼¹å¹•å¢™
                    </div>
                    <div class="danmaku-controls">
                        <button onclick="toggleDanmaku()">æš‚åœ/æ’­æ”¾</button>
                        <button onclick="clearDanmaku()">æ¸…å±</button>
                    </div>
                </div>
                <div class="danmaku-content" id="danmakuContent"></div>
                <div class="danmaku-input-container">
                    <input type="text" class="danmaku-input" id="danmakuInput" placeholder="å‘é€æ¶ˆæ¯...">
                    <button class="danmaku-send" onclick="sendDanmaku()">å‘é€</button>
                </div>
            </div>
            
            <!-- æ¬¢è¿æ¶ˆæ¯ -->
            <div class="welcome-message">
                <h2>æ¬¢è¿å›æ¥ï¼Œ<span th:text="${user.username}">ç”¨æˆ·å</span>ï¼</h2>
                <p>è¿™æ˜¯æ‚¨çš„ä¸ªäººæ§åˆ¶é¢æ¿ï¼Œæ‚¨å¯ä»¥åœ¨è¿™é‡Œç®¡ç†æ‚¨çš„ä¸ªäººä¿¡æ¯å’Œæ–‡æ¡£ã€‚</p>
            </div>
            
            <!-- ç»Ÿè®¡ä¿¡æ¯ -->
            <div class="dashboard-stats">
                <div class="stat-card">
                    <div class="stat-value" th:text="${documentCount}">12</div>
                    <div class="stat-label">æ–‡æ¡£æ€»æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" th:text="${categoryCount}">5</div>
                    <div class="stat-label">åˆ†ç±»æ€»æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" th:text="${todayDocumentCount}">20</div>
                    <div class="stat-label">ä»Šæ—¥æ–°å¢æ–‡æ¡£</div>
                </div>
            </div>
            
            <div class="shortcuts">
                <h2>å¿«æ·é“¾æ¥</h2>
                <div class="shortcut-list">
                    <a href="/dashboard/profile" class="shortcut-card">
                        <div class="shortcut-icon">ğŸ‘¤</div>
                        <div class="shortcut-text">æ›´æ–°ä¸ªäººä¿¡æ¯</div>
                    </a>
                    <a href="/dashboard/change-password" class="shortcut-card">
                        <div class="shortcut-icon">ğŸ”’</div>
                        <div class="shortcut-text">ä¿®æ”¹å¯†ç </div>
                    </a>
                    <a href="/dashboard/documents" class="shortcut-card">
                        <div class="shortcut-icon">ğŸ“</div>
                        <div class="shortcut-text">ç®¡ç†æ–‡æ¡£</div>
                    </a>
                    <a href="/dashboard/categories" class="shortcut-card">
                        <div class="shortcut-icon">ğŸ—‚ï¸</div>
                        <div class="shortcut-text">ç®¡ç†åˆ†ç±»</div>
                    </a>
                    <a href="/dashboard/documents/create" class="shortcut-card">
                        <div class="shortcut-icon">â•</div>
                        <div class="shortcut-text">åˆ›å»ºæ–°æ–‡æ¡£</div>
                    </a>
                    <a href="/dashboard/websites" class="shortcut-card">
                        <div class="shortcut-icon">ğŸ”—</div>
                        <div class="shortcut-text">ç½‘ç«™é“¾æ¥ç®¡ç†</div>
                    </a>
                    <a href="/danmaku" class="shortcut-card">
                        <div class="shortcut-icon">ğŸ’¬</div>
                        <div class="shortcut-text">å¼¹å¹•å¢™</div>
                    </a>
                    <a href="/" target="_blank" class="shortcut-card">
                        <div class="shortcut-icon">ğŸ </div>
                        <div class="shortcut-text">æŸ¥çœ‹é¦–é¡µ</div>
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <script src="/js/script.js"></script>
    
    <!-- å¼¹å¹•åŠŸèƒ½çš„JavaScriptä»£ç  -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const danmakuArea = document.getElementById('danmakuContent');
            const danmakuInput = document.getElementById('danmakuInput');
            let isPaused = false;
            let danmakuSpeed = 10000; // å¼¹å¹•ç§»åŠ¨é€Ÿåº¦ï¼Œå•ä½æ¯«ç§’
            
            // é¢„è®¾çš„ç³»ç»Ÿæ¶ˆæ¯
            const systemMessages = [
                "æ¬¢è¿ä½¿ç”¨ç§‘æŠ€æ–‡æ¡£ç®¡ç†ç³»ç»Ÿ",
                "æ‚¨æœ‰æ–°çš„ç³»ç»Ÿé€šçŸ¥ï¼Œè¯·æŸ¥çœ‹",
                "æ–‡æ¡£å·²è‡ªåŠ¨ä¿å­˜",
                "ç³»ç»Ÿå°†åœ¨åˆå¤œè¿›è¡Œä¾‹è¡Œç»´æŠ¤",
                "æœ‰æ–°çš„æ–‡æ¡£å…±äº«ç»™æ‚¨",
                "æ‚¨çš„è´¦æˆ·å®‰å…¨çŠ¶æ€è‰¯å¥½",
                "æ–°åŠŸèƒ½å‘å¸ƒï¼šAIè¾…åŠ©å†™ä½œ",
                "æ•°æ®åŒæ­¥å·²å®Œæˆ",
                "äº‘ç«¯å­˜å‚¨å®¹é‡å·²æ›´æ–°",
                "æ¨èå°è¯•æ–°çš„æ–‡æ¡£æ¨¡æ¿"
            ];
            
            // è·Ÿè¸ªå·²ä½¿ç”¨çš„å‚ç›´ä½ç½®
            const usedPositions = [];
            const laneHeight = 30; // æ¯ä¸ªå¼¹å¹•è½¨é“çš„é«˜åº¦
            const maxLanes = 5;    // æœ€å¤§è½¨é“æ•°é‡
            
            // å¼¹å¹•é˜Ÿåˆ—å’Œå¤„ç†çŠ¶æ€
            const danmakuQueue = [];
            let isProcessingQueue = false;
            
            // è·å–å¯ç”¨çš„å‚ç›´ä½ç½®
            function getAvailablePosition() {
                // è®¡ç®—å¯ç”¨çš„è½¨é“æ•°é‡
                const availableLanes = Math.floor((danmakuArea.offsetHeight - 10) / laneHeight);
                const lanes = Math.min(availableLanes, maxLanes);
                
                // å°è¯•æ‰¾åˆ°ä¸€ä¸ªæœªè¢«ä½¿ç”¨çš„è½¨é“
                for (let i = 0; i < lanes; i++) {
                    const position = i * laneHeight + 5;
                    if (!usedPositions.includes(position)) {
                        usedPositions.push(position);
                        return position;
                    }
                }
                
                // å¦‚æœæ‰€æœ‰è½¨é“éƒ½è¢«ä½¿ç”¨ï¼Œé€‰æ‹©ä¸€ä¸ªéšæœºè½¨é“
                const randomLane = Math.floor(Math.random() * lanes);
                return randomLane * laneHeight + 5;
            }
            
            // é‡Šæ”¾ä¸€ä¸ªä½ç½®
            function releasePosition(position) {
                const index = usedPositions.indexOf(position);
                if (index !== -1) {
                    usedPositions.splice(index, 1);
                }
            }
            
            // æ·»åŠ ä¸€æ¡å¼¹å¹•
            function addDanmaku(text, isSystem = false, colorType = null) {
                // å°†å¼¹å¹•æ·»åŠ åˆ°é˜Ÿåˆ—
                danmakuQueue.push({
                    text: text,
                    isSystem: isSystem,
                    colorType: colorType
                });
                
                // å¦‚æœé˜Ÿåˆ—æ²¡æœ‰åœ¨å¤„ç†ï¼Œå¼€å§‹å¤„ç†
                if (!isProcessingQueue) {
                    processQueue();
                }
            }
            
            // å¤„ç†å¼¹å¹•é˜Ÿåˆ—
            function processQueue() {
                if (danmakuQueue.length === 0) {
                    isProcessingQueue = false;
                    return;
                }
                
                isProcessingQueue = true;
                const item = danmakuQueue.shift();
                displayDanmaku(item.text, item.isSystem, item.colorType);
                
                // å›ºå®šé—´éš”å‘é€ä¸‹ä¸€æ¡å¼¹å¹•
                setTimeout(processQueue, 1000); // æ¯ç§’å‘é€ä¸€æ¡å¼¹å¹•
            }
            
            // æ˜¾ç¤ºå¼¹å¹•
            function displayDanmaku(text, isSystem, colorType) {
                if (isPaused) {
                    // å¦‚æœæš‚åœäº†ï¼Œå°†å¼¹å¹•æ”¾å›é˜Ÿåˆ—å‰é¢
                    danmakuQueue.unshift({
                        text: text,
                        isSystem: isSystem,
                        colorType: colorType
                    });
                    return;
                }
                
                const danmaku = document.createElement('div');
                danmaku.className = 'danmaku-item type-' + (colorType || (Math.floor(Math.random() * 3) + 1));
                danmaku.textContent = text;
                
                // è·å–æœ‰åºçš„å‚ç›´ä½ç½®
                const top = getAvailablePosition() + 'px';
                danmaku.style.top = top;
                
                // è®¾ç½®å›ºå®šçš„åŠ¨ç”»æŒç»­æ—¶é—´
                danmaku.style.animationDuration = (danmakuSpeed / 1000) + 's';
                
                // ä¸æ·»åŠ å»¶è¿Ÿï¼Œç¡®ä¿ä»å³ä¾§ç«‹å³å¼€å§‹
                danmaku.style.animationDelay = '0s';
                
                danmakuArea.appendChild(danmaku);
                
                // åŠ¨ç”»ç»“æŸåç§»é™¤å…ƒç´ å¹¶é‡Šæ”¾ä½ç½®
                danmaku.addEventListener('animationend', function() {
                    releasePosition(parseInt(top));
                    danmakuArea.removeChild(danmaku);
                });
            }
            
            // å‘é€å¼¹å¹•åˆ°æœåŠ¡å™¨å¹¶æ˜¾ç¤º
            function sendDanmakuToServer(text) {
                const colorType = Math.floor(Math.random() * 3) + 1;
                
                // æ˜¾ç¤ºæœ¬åœ°å¼¹å¹•
                addDanmaku(text, false, colorType);
                
                // å‘é€åˆ°æœåŠ¡å™¨
                fetch('/danmaku/api/send', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: `content=${encodeURIComponent(text)}&colorType=${colorType}`
                })
                .then(response => {
                    if (!response.ok) {
                        console.error('å‘é€å¼¹å¹•å¤±è´¥');
                    }
                    return response.json();
                })
                .catch(error => {
                    console.error('å‘é€å¼¹å¹•å‡ºé”™:', error);
                });
            }
            
            // å‘é€å¼¹å¹•
            window.sendDanmaku = function() {
                const text = danmakuInput.value.trim();
                if (text) {
                    sendDanmakuToServer(text);
                    danmakuInput.value = '';
                }
            }
            
            // æŒ‰Enteré”®å‘é€å¼¹å¹•
            danmakuInput.addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    sendDanmaku();
                }
            });
            
            // æš‚åœ/ç»§ç»­å¼¹å¹•
            window.toggleDanmaku = function() {
                isPaused = !isPaused;
                const danmakuItems = danmakuArea.querySelectorAll('.danmaku-item');
                danmakuItems.forEach(item => {
                    item.style.animationPlayState = isPaused ? 'paused' : 'running';
                });
                
                // å¦‚æœæ¢å¤æ’­æ”¾ä¸”é˜Ÿåˆ—æœ‰å†…å®¹ä½†æ²¡æœ‰åœ¨å¤„ç†ï¼Œé‡æ–°å¼€å§‹å¤„ç†
                if (!isPaused && danmakuQueue.length > 0 && !isProcessingQueue) {
                    processQueue();
                }
            }
            
            // æ¸…é™¤æ‰€æœ‰å¼¹å¹•
            window.clearDanmaku = function() {
                danmakuArea.innerHTML = '';
                // æ¸…ç©ºå·²ä½¿ç”¨çš„ä½ç½®å’Œé˜Ÿåˆ—
                usedPositions.length = 0;
                danmakuQueue.length = 0;
                isProcessingQueue = false;
            }
            
            // å®šæœŸæ·»åŠ ç³»ç»Ÿå¼¹å¹•
            function addSystemDanmaku() {
                if (!isPaused) {
                    const randomIndex = Math.floor(Math.random() * systemMessages.length);
                    const randomMessage = systemMessages[randomIndex];
                    addDanmaku("ç³»ç»Ÿ: " + randomMessage, true);
                }
                
                // é—´éš”æ·»åŠ ç³»ç»Ÿå¼¹å¹•
                const nextTimeout = 8000; // å›ºå®š8ç§’æ·»åŠ ä¸€æ¡
                setTimeout(addSystemDanmaku, nextTimeout);
            }
            
            // åˆå§‹æ˜¾ç¤ºå¼¹å¹•
            setTimeout(function() {
                // å…ˆæ˜¾ç¤ºæ¬¢è¿å¼¹å¹•
                addDanmaku("ç³»ç»Ÿ: æ¬¢è¿å›æ¥ï¼Œ" + (document.querySelector('.welcome-message span').textContent || 'ç”¨æˆ·') + "ï¼", true);
                
                // å†æ˜¾ç¤ºä¸€äº›ç³»ç»Ÿå¼¹å¹•
                for (let i = 0; i < 3; i++) {
                    const randomIndex = Math.floor(Math.random() * systemMessages.length);
                    addDanmaku("ç³»ç»Ÿ: " + systemMessages[randomIndex], true);
                }
                
                // å¼€å§‹å®šæœŸæ·»åŠ ç³»ç»Ÿå¼¹å¹•
                setTimeout(addSystemDanmaku, 10000);
            }, 1000);
        });
    </script>
</body>
</html> 